<html>

<head>
    <h1>Search Test</h1>
</head>


<body bgcolor="lightblue">
    <div class="radioDiv" id="radioD">
        <input type="radio" onClick="clearLogicOperationDiv()" id="r4" name="radiostar" value="Search" checked="checked" />Search
        <button type="button" onclick="Go()" id="goButton">Go</button>
    </div>
    <div class="operationLogicDiv" id="logicDiv">
        <table class="altrowstable" id="searchTable"></table>
    </div>
    </div>
</body>

<script>
    function Go() {
        clearLogicOperationDiv();
        var operation = getOperationSelected();
        if (operation == "Search") {
            console.log("Search selected");
            performSearch();
        } else {
            console.log("error at Go()");
        }
    }

    function getOperationSelected() {
        var radioButtonValue;
        /*
        if (document.getElementById("r1").checked) {
            radioButtonValue = document.getElementById("r1").value;
        } else if (document.getElementById("r2").checked) {
            radioButtonValue = document.getElementById("r2").value;
        } else if (document.getElementById("r3").checked) {
            radioButtonValue = document.getElementById("r3").value;
        } else if (document.getElementById("r4").checked) {
            radioButtonValue = document.getElementById("r4").value;
        } else {
            console.log("error at getOperationSelected(), radio stuff");
            radioButtonValue = "";
        }
        */
        radioButtonValue = "Search";

        return radioButtonValue;
    }

    function clearLogicOperationDiv() {
        var operationLogicDiv = document.getElementById("logicDiv");
        while (operationLogicDiv.hasChildNodes()) {
            operationLogicDiv.removeChild(operationLogicDiv.firstChild);
        }
    }

    function performSearch() {
        console.log("This is inside performSearch");
        var OpLogicDiv = document.getElementById("logicDiv");
        var inputTextBox = createTextBox(
            OpLogicDiv,
            "search" + "_" + "1",
            "Enter a book title (partial or full) and search: ",
            ""
        );
        var button = document.createElement("button");
        button.innerHTML = "Search";

        OpLogicDiv.appendChild(button);

        button.addEventListener("click", function () {
            clearLogicOperationDiv();
            var partialOrFullTitle = inputTextBox.value;

            console.log("partial or full title String:" + partialOrFullTitle);
            displaySearchResultTable(partialOrFullTitle);
        });
    }

    function displaySearchResultTable(partialOrFullTitle) {
        var parentDiv = document.getElementById("logicDiv");
        var table = document.createElement("TABLE");
        table.className = "altrowstable";
        table.id = "searchTable";
        parentDiv.appendChild(table);
        console.log(table);
        var query = getSearchQuery(partialOrFullTitle);
        var url = "localhost";
        var params = "table=" + "search" + "&query=" + query;
        console.log("Search query:" + query);
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                var finalQueryResult = xhr.responseText;
                console.log(finalQueryResult);
                var myJsonObject = JSON.parse(finalQueryResult);


                while (table.hasChildNodes()) {
                    table.removeChild(table.firstChild);
                }
                var row = table.insertRow(-1);
                row.className = "headingrowcolor2";
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                var cell6 = row.insertCell(5);
                var cell7 = row.insertCell(6);
                var cell8 = row.insertCell(7);
                var cell9 = row.insertCell(8);

                cell1.innerHTML = "title".bold();
                cell2.innerHTML = "availability".bold();
                cell5.innerHTML = "authorFirst".bold();
                cell6.innerHTML = "authorLast".bold();
                cell7.innerHTML = "publisherCode".bold();
                cell8.innerHTML = "publisherName".bold();
                cell9.innerHTML = "city".bold();
                for (var i = 0; i < myJsonObject.length; i++) {
                    populateTable(myJsonObject[i], "searchResult", i);
                }
            }
        };
        xhr.open("POST", url, true);

        xhr.setRequestHeader(
            "Content-type",
            "application/x-www-form-urlencoded"
        );

        xhr.send(params);
    }

    function getSearchQuery(partialOrFullTitle) {
        var searchQ =
            "select B.title, B.numCopies, A.authorNum,A.authorLast,A.authorFirst,P.publisherCode,P.publisherName,P.city from book B, author A,publisher P, wrote W where (B.publisherCode ~ P.publisherCode and A.authorNum ~ W.authorNum and W.bookCode ~ B.bookCode) and B.title LIKE " +
            '"%' +
            partialOrFullTitle +
            '%"';
        return searchQ;
    }

    function getSearchQuery(partialOrFullTitle) {
        var searchQ =
            "select B.title, B.numCopies, A.authorNum,A.authorLast,A.authorFirst,P.publisherCode,P.publisherName,P.city from book B, author A,publisher P, wrote W where (B.publisherCode ~ P.publisherCode and A.authorNum ~ W.authorNum and W.bookCode ~ B.bookCode) and B.title LIKE " +
            '"%' +
            partialOrFullTitle +
            '%"';
        return searchQ;
    }

    function createTextBox(parent, ID, lable, text) {
      var newDiv = document.createElement("div");
      newDiv.id = "divOf_" + ID;
      newDiv.className = "newDiv";
      var element = document.createElement("input");
      element.id = ID;

      var label = document.createElement("Label");
      label.innerHTML = lable;

      element.setAttribute("type", "text");
      element.setAttribute("value", text);
      element.setAttribute("name", "Test Name");
      element.setAttribute("style", "width:200px");

      label.setAttribute("style", "font-weight:normal");

      newDiv.appendChild(label);
      newDiv.appendChild(element);
      parent.appendChild(newDiv);
      return element;
    }

    function createGUIforInsert() {
      var elementList = [];
      var sqltable = document.getElementById("table").value;

      var OpLogicDiv = document.getElementById("logicDiv");
      if (sqltable == "author") {
        var authNum = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 1,
          "authorNum: ",
          ""
        );
        var first = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "authorLast: ",
          ""
        );
        var last = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "authorFirst: ",
          ""
        );
        elementList.push(authNum);
        elementList.push(first);
        elementList.push(last);
        console.log(JSON.stringify(elementList));
        console.log(authNum.value);
      } else if (sqltable == "book") {
        var bookCode = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 1,
          "bookCode: ",
          ""
        );
        var title = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "title: ",
          ""
        );
        var publisherCode = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "publisherCode: ",
          ""
        );
        var type = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "type: ",
          ""
        );
        var paperback = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "paperback: ",
          ""
        );
        elementList.push(bookCode);
        elementList.push(title);
        elementList.push(publisherCode);
        elementList.push(type);
        elementList.push(paperback);
      } else if (sqltable == "copy") {
        var bookCode = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 1,
          "bookCode: ",
          ""
        );
        var branchNum = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "branchNum: ",
          ""
        );
        var copyNum = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "copyNum: ",
          ""
        );
        var quality = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "quality: ",
          ""
        );
        var price = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "price: ",
          ""
        );
        elementList.push(bookCode);
        elementList.push(branchNum);
        elementList.push(copyNum);
        elementList.push(quality);
        elementList.push(price);
      } else if (sqltable == "publisher") {
        var publisherCode = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 1,
          "publisherCode: ",
          ""
        );
        var publisherName = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "publisherName: ",
          ""
        );
        var city = createTextBox(OpLogicDiv, sqltable + "_" + 2, "city: ");
        elementList.push(publisherCode);
        elementList.push(publisherName);
        elementList.push(city);
      } else if (sqltable == "wrote") {
        var bookCode = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 1,
          "bookCode: ",
          ""
        );
        var authorNum = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "authorNum: ",
          ""
        );
        var sequence = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "sequence: ",
          ""
        );
        elementList.push(bookCode);
        elementList.push(authorNum);
        elementList.push(sequence);
      } else if (sqltable == "inventory") {
        var BookCode = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 1,
          "BookCode: ",
          ""
        );
        var BranchNum = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "BranchNum: ",
          ""
        );
        var OnHand = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "OnHand: ",
          ""
        );
        elementList.push(BookCode);
        elementList.push(BranchNum);
        elementList.push(OnHand);
      } else if (sqltable == "branch") {
        var branchNum = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 1,
          "branchNum: ",
          ""
        );
        var branchName = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "branchName: ",
          ""
        );
        var branchLocation = createTextBox(
          OpLogicDiv,
          sqltable + "_" + 2,
          "branchLocation: ",
          ""
        );
        elementList.push(branchNum);
        elementList.push(branchName);
        elementList.push(branchLocation);
      } else {
        console.log("Error at createGUIforInsert()");
      }
      var button = document.createElement("button");
      button.innerHTML = "Submit";
      OpLogicDiv.appendChild(button);
      INSERT_query = "";
      var s = "";
      s = "(";
      button.addEventListener("click", function () {
        for (var i = 0; i < elementList.length; i++) {
          var text = elementList[i].value;
          console.log(s);

          if (i == elementList.length - 1) {
            s += "'" + text + "'";
          } else {
            s += "'" + text + "'" + ",";
          }
        }
        s += ")";
        INSERT_query = s;
        console.log("insert String:" + s);
        addTuple();
        clearLogicOperationDiv();
        displayTable();
      });
    }

    function populateTable(json, tablesql, i) {
      var table = document.getElementById("myTable");

      if (tablesql == "searchResult") {
        console.log("searchResult selected");
        var table = document.getElementById("searchTable");
        var row = table.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);
        var cell8 = row.insertCell(7);
        var cell9 = row.insertCell(8);

        cell1.innerHTML = json.title;
        cell2.innerHTML = json.OnHand;
        cell3.innerHTML = json.BranchNum;
        cell4.innerHTML = json.authorNum;
        cell5.innerHTML = json.authorLast;
        cell6.innerHTML = json.authorFirst;
        cell7.innerHTML = json.publisherCode;
        cell8.innerHTML = json.publisherName;
        cell9.innerHTML = json.city;
      } else if (tablesql === "author") {
        var row = table.insertRow(-1);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        cell0.appendChild(
          createCheckBox({
              authorNum: json.authorNum,
              authorLast: json.authorLast + "",
              authorFirst: json.authorFirst + ""
            },
            i
          )
        );
        cell1.innerHTML = json.authorNum;
        cell2.innerHTML = json.authorLast;
        cell3.innerHTML = json.authorFirst;
      } else if (tablesql == "book") {
        var row = table.insertRow(-1);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        var cell4 = row.insertCell(4);
        var cell5 = row.insertCell(5);
        cell0.appendChild(
          createCheckBox({
              bookCode: json.bookCode + "",
              title: json.title + "",
              publisherCode: json.publisherCode + "",
              type: json.type + "",
              paperback: json.paperback + ""
            },
            i
          )
        );
        cell1.innerHTML = json.bookCode;
        cell2.innerHTML = json.title;
        cell3.innerHTML = json.publisherCode;
        cell4.innerHTML = json.type;
        cell5.innerHTML = json.paperback;
      } else if (tablesql == "copy") {
        var row = table.insertRow(-1);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        var cell4 = row.insertCell(4);
        var cell5 = row.insertCell(5);
        cell0.appendChild(
          createCheckBox({
              bookCode: json.bookCode + "",
              branchNum: json.branchNum,
              copyNum: json.copyNum,
              quality: json.quality + "",
              price: json.price
            },
            i
          )
        );
        cell1.innerHTML = json.bookCode;
        cell2.innerHTML = json.branchNum;
        cell3.innerHTML = json.copyNum;
        cell4.innerHTML = json.quality;
        cell5.innerHTML = json.price;
      } else if (tablesql == "publisher") {
        var row = table.insertRow(-1);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        cell0.appendChild(
          createCheckBox({
              publisherCode: json.publisherCode + "",
              publisherName: json.publisherName + "",
              city: json.city + ""
            },
            i
          )
        );
        cell1.innerHTML = json.publisherCode;
        cell2.innerHTML = json.publisherName;
        cell3.innerHTML = json.city;
      } else if (tablesql == "wrote") {
        var row = table.insertRow(-1);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        cell0.appendChild(
          createCheckBox({
              bookCode: json.bookCode + "",
              authorNum: json.authorNum,
              sequence: json.sequence
            },
            i
          )
        );
        cell1.innerHTML = json.bookCode;
        cell2.innerHTML = json.authorNum;
        cell3.innerHTML = json.sequence;
      } else if (tablesql == "inventory") {
        var row = table.insertRow(-1);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        cell0.appendChild(
          createCheckBox({
              BookCode: json.BookCode + "",
              BranchNum: json.BranchNum,
              OnHand: json.OnHand
            },
            i
          )
        );
        cell1.innerHTML = json.BookCode;
        cell2.innerHTML = json.BranchNum;
        cell3.innerHTML = json.OnHand;
      } else if (tablesql == "branch") {
        var row = table.insertRow(-1);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        cell0.appendChild(
          createCheckBox({
              branchNum: json.branchNum,
              branchName: json.branchName + "",
              branchLocation: json.branchLocation + ""
            },
            i
          )
        );
        cell1.innerHTML = json.branchNum;
        cell2.innerHTML = json.branchName;
        cell3.innerHTML = json.branchLocation;
      } else {
        console.log("Error at populateTable");
      }
    }
</script>

</html>