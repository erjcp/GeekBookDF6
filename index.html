<!DOCTYPE html>
<html>
  <head>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <link rel="stylesheet" type="text/css" href="css/bookstyle.css">
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">BookStore DragonForce</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="#">Browse <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Details</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Shopping Cart</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Profile
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
              <a class="dropdown-item" href="#">Log in</a>
              <a class="dropdown-item" href="#">Edit Profile</a>
              <a class="dropdown-item" href="#">Log out</a>
            </div>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
        <div class="container header">
            <h1>Book Browsing</h1>
            <form class="form-inline my-2 my-lg-0">
              <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" id="input-search">
              <button class="btn btn-outline-success my-2 my-sm-0" type="submit" onclick="clickSearch()" id="btn-search">Search</button>
            </form>
            
        </div>
        <table class="table">
            <thead class="thead-dark">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Title</th>
                <th scope="col">Author</th>
                <th scope="col">Publisher</th>
                <th scope="col">Availability</th>
              </tr>
            </thead>
            <tbody>          
              <tr class="clickable-row" data-href="">
                <th scope="row">1</th>
                <td>Mark</td>
                <td>Otto</td>
                <td>@mdo</td>
                <td>available</td>
              </tr>
              <tr class="clickable-row" data-href=""> 
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat</td>
                <td>unavailale</td>
              </tr>
            </tbody>
        </table>
      </div>

    <h1>Search Test</h1>
    <div class="radioDiv" id="radioD">
        <input type="radio" onClick="clearLogicOperationDiv()" id="r4" name="radiostar" value="Search" checked="checked" />Search
        <button type="button" onclick="Go()" id="goButton">Go</button>
    </div>
    <div class="operationLogicDiv" id="logicDiv">
        <table class="altrowstable" id="searchTable"></table>
    </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>
      document.getElementById("btn-search").addEventListener("click", function () {
        var textBox = document.getElementById("input-search");
        var partialOrFullTitle = textBox.value;
        console.log("partial or full title String:" + partialOrFullTitle);
        displaySearchResultTable(partialOrFullTitle);
      });

      
    </script>
    <script>


        function Go() {
            clearLogicOperationDiv();
            var operation = getOperationSelected();
            if (operation == "Search") {
                console.log("Search selected");
                performSearch();
            } else {
                console.log("error at Go()");
            }
        }
  
        function getOperationSelected() {
            var radioButtonValue;
            /*
            if (document.getElementById("r1").checked) {
                radioButtonValue = document.getElementById("r1").value;
            } else if (document.getElementById("r2").checked) {
                radioButtonValue = document.getElementById("r2").value;
            } else if (document.getElementById("r3").checked) {
                radioButtonValue = document.getElementById("r3").value;
            } else if (document.getElementById("r4").checked) {
                radioButtonValue = document.getElementById("r4").value;
            } else {
                console.log("error at getOperationSelected(), radio stuff");
                radioButtonValue = "";
            }
            */
            radioButtonValue = "Search";
  
            return radioButtonValue;
        }


        function clearLogicOperationDiv() {
            var operationLogicDiv = document.getElementById("logicDiv");
            while (operationLogicDiv.hasChildNodes()) {
                operationLogicDiv.removeChild(operationLogicDiv.firstChild);
            }
        }

        
  
        function performSearch() {
            console.log("This is inside performSearch");
            var OpLogicDiv = document.getElementById("logicDiv");
            var inputTextBox = createTextBox(
                OpLogicDiv,
                "search" + "_" + "1",
                "Enter a book title (partial or full) and search: ",
                ""
            );
            var button = document.createElement("button");
            button.innerHTML = "Search";
  
            OpLogicDiv.appendChild(button);
  
            button.addEventListener("click", function () {
                clearLogicOperationDiv();
                var partialOrFullTitle = inputTextBox.value;
  
                console.log("partial or full title String:" + partialOrFullTitle);
                displaySearchResultTable(partialOrFullTitle);
            });
        }
  
        function displaySearchResultTable(partialOrFullTitle) {
            var parentDiv = document.getElementById("logicDiv");
            var table = document.createElement("TABLE");
            table.className = "altrowstable";
            table.id = "searchTable";
            parentDiv.appendChild(table);
            console.log(table);
            var query = getSearchQuery(partialOrFullTitle);
            var url = "localhost";
            var params = "table=" + "search" + "&query=" + query;
            console.log("Search query:" + query);
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    var finalQueryResult = xhr.responseText;
                    console.log(finalQueryResult);
                    var myJsonObject = JSON.parse(finalQueryResult);
  
  
                    while (table.hasChildNodes()) {
                        table.removeChild(table.firstChild);
                    }
                    var row = table.insertRow(-1);
                    row.className = "headingrowcolor2";
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    var cell4 = row.insertCell(3);
                    var cell5 = row.insertCell(4);
                    var cell6 = row.insertCell(5);
                    var cell7 = row.insertCell(6);
                    var cell8 = row.insertCell(7);
                    var cell9 = row.insertCell(8);
  
                    cell1.innerHTML = "title".bold();
                    cell2.innerHTML = "availability".bold();
                    cell5.innerHTML = "authorFirst".bold();
                    cell6.innerHTML = "authorLast".bold();
                    cell7.innerHTML = "publisherCode".bold();
                    cell8.innerHTML = "publisherName".bold();
                    cell9.innerHTML = "city".bold();
                    for (var i = 0; i < myJsonObject.length; i++) {
                        populateTable(myJsonObject[i], "searchResult", i);
                    }
                }
            };
            xhr.open("POST", url, true);
  
            xhr.setRequestHeader(
                "Content-type",
                "application/x-www-form-urlencoded"
            );
  
            xhr.send(params);
        }
  
        function getSearchQuery(partialOrFullTitle) {
            var searchQ =
                "select B.title, B.numCopies, A.authorNum,A.authorLast,A.authorFirst,P.publisherCode,P.publisherName,P.city from book B, author A,publisher P, wrote W where (B.publisherCode ~ P.publisherCode and A.authorNum ~ W.authorNum and W.bookCode ~ B.bookCode) and B.title LIKE " +
                '"%' +
                partialOrFullTitle +
                '%"';
            return searchQ;
        }
  
        function getSearchQuery(partialOrFullTitle) {
            var searchQ =
                "select B.title, B.numCopies, A.authorNum,A.authorLast,A.authorFirst,P.publisherCode,P.publisherName,P.city from book B, author A,publisher P, wrote W where (B.publisherCode ~ P.publisherCode and A.authorNum ~ W.authorNum and W.bookCode ~ B.bookCode) and B.title LIKE " +
                '"%' +
                partialOrFullTitle +
                '%"';
            return searchQ;
        }
  
        function createTextBox(parent, ID, lable, text) {
          var newDiv = document.createElement("div");
          newDiv.id = "divOf_" + ID;
          newDiv.className = "newDiv";
          var element = document.createElement("input");
          element.id = ID;
  
          var label = document.createElement("Label");
          label.innerHTML = lable;
  
          element.setAttribute("type", "text");
          element.setAttribute("value", text);
          element.setAttribute("name", "Test Name");
          element.setAttribute("style", "width:200px");
  
          label.setAttribute("style", "font-weight:normal");
  
          newDiv.appendChild(label);
          newDiv.appendChild(element);
          parent.appendChild(newDiv);
          return element;
        }
  
        function createGUIforInsert() {
          var elementList = [];
          var sqltable = document.getElementById("table").value;
  
          var OpLogicDiv = document.getElementById("logicDiv");
          if (sqltable == "author") {
            var authNum = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 1,
              "authorNum: ",
              ""
            );
            var first = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "authorLast: ",
              ""
            );
            var last = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "authorFirst: ",
              ""
            );
            elementList.push(authNum);
            elementList.push(first);
            elementList.push(last);
            console.log(JSON.stringify(elementList));
            console.log(authNum.value);
          } else if (sqltable == "book") {
            var bookCode = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 1,
              "bookCode: ",
              ""
            );
            var title = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "title: ",
              ""
            );
            var publisherCode = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "publisherCode: ",
              ""
            );
            var type = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "type: ",
              ""
            );
            var paperback = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "paperback: ",
              ""
            );
            elementList.push(bookCode);
            elementList.push(title);
            elementList.push(publisherCode);
            elementList.push(type);
            elementList.push(paperback);
          } else if (sqltable == "copy") {
            var bookCode = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 1,
              "bookCode: ",
              ""
            );
            var branchNum = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "branchNum: ",
              ""
            );
            var copyNum = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "copyNum: ",
              ""
            );
            var quality = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "quality: ",
              ""
            );
            var price = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "price: ",
              ""
            );
            elementList.push(bookCode);
            elementList.push(branchNum);
            elementList.push(copyNum);
            elementList.push(quality);
            elementList.push(price);
          } else if (sqltable == "publisher") {
            var publisherCode = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 1,
              "publisherCode: ",
              ""
            );
            var publisherName = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "publisherName: ",
              ""
            );
            var city = createTextBox(OpLogicDiv, sqltable + "_" + 2, "city: ");
            elementList.push(publisherCode);
            elementList.push(publisherName);
            elementList.push(city);
          } else if (sqltable == "wrote") {
            var bookCode = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 1,
              "bookCode: ",
              ""
            );
            var authorNum = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "authorNum: ",
              ""
            );
            var sequence = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "sequence: ",
              ""
            );
            elementList.push(bookCode);
            elementList.push(authorNum);
            elementList.push(sequence);
          } else if (sqltable == "inventory") {
            var BookCode = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 1,
              "BookCode: ",
              ""
            );
            var BranchNum = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "BranchNum: ",
              ""
            );
            var OnHand = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "OnHand: ",
              ""
            );
            elementList.push(BookCode);
            elementList.push(BranchNum);
            elementList.push(OnHand);
          } else if (sqltable == "branch") {
            var branchNum = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 1,
              "branchNum: ",
              ""
            );
            var branchName = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "branchName: ",
              ""
            );
            var branchLocation = createTextBox(
              OpLogicDiv,
              sqltable + "_" + 2,
              "branchLocation: ",
              ""
            );
            elementList.push(branchNum);
            elementList.push(branchName);
            elementList.push(branchLocation);
          } else {
            console.log("Error at createGUIforInsert()");
          }
          var button = document.createElement("button");
          button.innerHTML = "Submit";
          OpLogicDiv.appendChild(button);
          INSERT_query = "";
          var s = "";
          s = "(";
          button.addEventListener("click", function () {
            for (var i = 0; i < elementList.length; i++) {
              var text = elementList[i].value;
              console.log(s);
  
              if (i == elementList.length - 1) {
                s += "'" + text + "'";
              } else {
                s += "'" + text + "'" + ",";
              }
            }
            s += ")";
            INSERT_query = s;
            console.log("insert String:" + s);
            addTuple();
            clearLogicOperationDiv();
            displayTable();
          });
        }
  
        function populateTable(json, tablesql, i) {
          var table = document.getElementById("myTable");
  
          if (tablesql == "searchResult") {
            console.log("searchResult selected");
            var table = document.getElementById("searchTable");
            var row = table.insertRow(-1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            var cell6 = row.insertCell(5);
            var cell7 = row.insertCell(6);
            var cell8 = row.insertCell(7);
            var cell9 = row.insertCell(8);
  
            cell1.innerHTML = json.title;
            cell2.innerHTML = json.OnHand;
            cell3.innerHTML = json.BranchNum;
            cell4.innerHTML = json.authorNum;
            cell5.innerHTML = json.authorLast;
            cell6.innerHTML = json.authorFirst;
            cell7.innerHTML = json.publisherCode;
            cell8.innerHTML = json.publisherName;
            cell9.innerHTML = json.city;
          } else if (tablesql === "author") {
            var row = table.insertRow(-1);
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            cell0.appendChild(
              createCheckBox({
                  authorNum: json.authorNum,
                  authorLast: json.authorLast + "",
                  authorFirst: json.authorFirst + ""
                },
                i
              )
            );
            cell1.innerHTML = json.authorNum;
            cell2.innerHTML = json.authorLast;
            cell3.innerHTML = json.authorFirst;
          } else if (tablesql == "book") {
            var row = table.insertRow(-1);
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            var cell4 = row.insertCell(4);
            var cell5 = row.insertCell(5);
            cell0.appendChild(
              createCheckBox({
                  bookCode: json.bookCode + "",
                  title: json.title + "",
                  publisherCode: json.publisherCode + "",
                  type: json.type + "",
                  paperback: json.paperback + ""
                },
                i
              )
            );
            cell1.innerHTML = json.bookCode;
            cell2.innerHTML = json.title;
            cell3.innerHTML = json.publisherCode;
            cell4.innerHTML = json.type;
            cell5.innerHTML = json.paperback;
          } else if (tablesql == "copy") {
            var row = table.insertRow(-1);
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            var cell4 = row.insertCell(4);
            var cell5 = row.insertCell(5);
            cell0.appendChild(
              createCheckBox({
                  bookCode: json.bookCode + "",
                  branchNum: json.branchNum,
                  copyNum: json.copyNum,
                  quality: json.quality + "",
                  price: json.price
                },
                i
              )
            );
            cell1.innerHTML = json.bookCode;
            cell2.innerHTML = json.branchNum;
            cell3.innerHTML = json.copyNum;
            cell4.innerHTML = json.quality;
            cell5.innerHTML = json.price;
          } else if (tablesql == "publisher") {
            var row = table.insertRow(-1);
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            cell0.appendChild(
              createCheckBox({
                  publisherCode: json.publisherCode + "",
                  publisherName: json.publisherName + "",
                  city: json.city + ""
                },
                i
              )
            );
            cell1.innerHTML = json.publisherCode;
            cell2.innerHTML = json.publisherName;
            cell3.innerHTML = json.city;
          } else if (tablesql == "wrote") {
            var row = table.insertRow(-1);
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            cell0.appendChild(
              createCheckBox({
                  bookCode: json.bookCode + "",
                  authorNum: json.authorNum,
                  sequence: json.sequence
                },
                i
              )
            );
            cell1.innerHTML = json.bookCode;
            cell2.innerHTML = json.authorNum;
            cell3.innerHTML = json.sequence;
          } else if (tablesql == "inventory") {
            var row = table.insertRow(-1);
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            cell0.appendChild(
              createCheckBox({
                  BookCode: json.BookCode + "",
                  BranchNum: json.BranchNum,
                  OnHand: json.OnHand
                },
                i
              )
            );
            cell1.innerHTML = json.BookCode;
            cell2.innerHTML = json.BranchNum;
            cell3.innerHTML = json.OnHand;
          } else if (tablesql == "branch") {
            var row = table.insertRow(-1);
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            cell0.appendChild(
              createCheckBox({
                  branchNum: json.branchNum,
                  branchName: json.branchName + "",
                  branchLocation: json.branchLocation + ""
                },
                i
              )
            );
            cell1.innerHTML = json.branchNum;
            cell2.innerHTML = json.branchName;
            cell3.innerHTML = json.branchLocation;
          } else {
            console.log("Error at populateTable");
          }
        }
    </script>
  </body>
</html>